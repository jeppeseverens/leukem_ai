# Define merge mapping for connecting lines
merge_mapping <- list(
"Other KMT2A rearrangements" = c("KMT2A::ELL", "KMT2A::MLLT10", "KMT2A::MLLT4", "KMT2A::SEPT6"),
"MDS-related" = c("MDS-related, gene mutations", "MDS-related, cytogenetic abnormalities", "MDS-related, TP53 mutated", "MDS.r")
)
# Create category groups for coloring
f1_comparison <- f1_comparison %>%
mutate(
Category = case_when(
Class %in% c("PML::RARA", "RUNX1::RUNX1T1", "CBFB::MYH11") ~ "CBF",
Class %in% c("MLLT3::KMT2A", "Other KMT2A rearrangements", "KMT2A::ELL", "KMT2A::MLLT10", "KMT2A::MLLT4", "KMT2A::SEPT6") ~ "KMT2A",
Class %in% c("NUP98::NSD1", "NUP98::KDM5A", "NUP98, other partners") ~ "NUP98",
Class %in% c("MDS-related", "MDS-related, gene mutations", "MDS-related, cytogenetic abnormalities", "MDS-related, TP53 mutated", "MDS.r") ~ "MDS-related",
Class %in% c("DEK::NUP214", "MECOM rearrangement", "BCR::ABL1", "Mutated NPM1", "CEBPA bZIP in-frame") ~ "Other",
Class %in% c("PRDM16::RPN1", "NPM1::MLF1", "KAT6A::CREBBP", "RBM15::MRTF1", "ETV6::MNX1", "PICALM::MLLT10", "FUS::ERG", "RUNX1::CBFA2T3", "CBFA2T3::GLIS2") ~ "Rare translocations",
TRUE ~ "Other"
)
)
# Order classes consistently
all_classes_ordered <- c(
"PML::RARA", "RUNX1::RUNX1T1", "CBFB::MYH11",
"MLLT3::KMT2A", "Other KMT2A rearrangements", "KMT2A::ELL", "KMT2A::MLLT10", "KMT2A::MLLT4", "KMT2A::SEPT6",
"DEK::NUP214", "MECOM rearrangement", "BCR::ABL1",
"PRDM16::RPN1", "NPM1::MLF1", "KAT6A::CREBBP", "RBM15::MRTF1", "NUP98::KDM5A", "NUP98, other partners",
"ETV6::MNX1", "PICALM::MLLT10", "FUS::ERG", "RUNX1::CBFA2T3", "CBFA2T3::GLIS2",
"NUP98::NSD1", "Mutated NPM1", "CEBPA bZIP in-frame",
"MDS-related", "MDS-related, gene mutations", "MDS-related, cytogenetic abnormalities", "MDS-related, TP53 mutated", "MDS.r"
)
f1_comparison$Class <- factor(f1_comparison$Class, levels = rev(all_classes_ordered))
# Create color palette for categories
category_colors <- c(
"CBF" = "#1f77b4",
"KMT2A" = "#ff7f0e",
"NUP98" = "#2ca02c",
"MDS-related" = "#d62728",
"Rare translocations" = "#9467bd",
"Other" = "#8c564b"
)
# Panel A: F1 Comparison Plot
panel_a <- ggplot(f1_comparison, aes(x = F1, y = Class, color = Category, shape = Type)) +
geom_point(size = 2.5, alpha = 0.8, position = position_dodge(width = 0.5)) +
geom_vline(xintercept = 0.9, linetype = "dashed", color = "gray50", alpha = 0.5) +
scale_color_manual(values = category_colors, name = "Category") +
scale_shape_manual(values = c("Full" = 16, "Merged" = 17), name = "Type") +
labs(
x = "F1 Score",
y = "",
title = "A. F1 Scores: Full vs Merged Classes"
) +
theme_bw() +
theme(
plot.title = element_text(face = "bold", size = 11),
axis.text.y = element_text(size = 8),
axis.text.x = element_text(size = 9),
legend.position = "right",
legend.text = element_text(size = 8),
legend.title = element_text(size = 9)
) +
xlim(0.5, 1.0)
# Panel B & C: Error Heatmaps for KMT2A and MDS groups
# Function to extract and prepare confusion matrix for specific groups
get_error_heatmap <- function(res_obj, type, label_set, focus_groups) {
# Get confusion matrices across folds
conf_table <- list()
# Determine model name - check what's available
available_models <- names(res_obj$detailed_performance[[type]])
model_name <- if ("OvR_Ensemble" %in% available_models) {
"OvR_Ensemble"
} else if ("Global_Optimized" %in% available_models) {
"Global_Optimized"
} else {
available_models[1]  # Use first available model
}
if (is.null(model_name) || !model_name %in% names(res_obj$detailed_performance[[type]])) {
return(NULL)
}
for (fold in names(res_obj$detailed_performance[[type]][[model_name]])) {
cm_obj <- res_obj$detailed_performance[[type]][[model_name]][[fold]]$confusion_matrix
if (!is.null(cm_obj) && !is.null(cm_obj$table)) {
conf_table[[fold]] <- cm_obj$table
}
}
if (length(conf_table) == 0) {
return(NULL)
}
# Get all unique classes
all_classes <- unique(unlist(lapply(conf_table, function(x) c(rownames(x), colnames(x)))))
if (length(all_classes) == 0) {
return(NULL)
}
# Pad each confusion matrix
conf_table_padded <- lapply(conf_table, function(mat) {
padded_mat <- matrix(
0,
nrow = length(all_classes),
ncol = length(all_classes),
dimnames = list(all_classes, all_classes)
)
padded_mat[rownames(mat), colnames(mat)] <- mat
padded_mat
})
# Sum across folds
total_conf <- Reduce("+", conf_table_padded)
total_conf <- t(total_conf)
# Apply pretty names
rownames(total_conf) <- fix_names(rownames(total_conf))
colnames(total_conf) <- fix_names(colnames(total_conf))
# Debug: Print available classes and focus groups
cat(sprintf("\n%s - Available classes after fix_names:\n", label_set))
cat(paste(rownames(total_conf), collapse = ", "), "\n")
cat(sprintf("Focus groups:\n"))
cat(paste(focus_groups, collapse = ", "), "\n")
# Filter to focus groups - show square matrix of focus classes
focus_classes <- intersect(focus_groups, rownames(total_conf))
cat(sprintf("Matched focus classes:\n"))
cat(paste(focus_classes, collapse = ", "), "\n\n")
if (length(focus_classes) == 0) {
return(NULL)
}
# Show square matrix: focus classes as both rows and columns
# This shows errors between the focus classes themselves
conf_focused <- total_conf[focus_classes, focus_classes, drop = FALSE]
# Debug: Print the full confusion matrix and focused subset
cat(sprintf("%s - Full confusion matrix dimensions: %d x %d\n", label_set, nrow(total_conf), ncol(total_conf)))
cat(sprintf("%s - Focused confusion matrix (counts):\n", label_set))
print(conf_focused)
# Check for off-diagonal errors
off_diag <- conf_focused
diag(off_diag) <- 0
cat(sprintf("%s - Off-diagonal errors (sum): %d\n", label_set, sum(off_diag)))
cat("\n")
# Calculate row percentages (error rates)
row_sums <- rowSums(conf_focused)
conf_percent <- sweep(conf_focused, 1, row_sums, "/") * 100
conf_percent[is.nan(conf_percent)] <- 0
return(list(
counts = conf_focused,
percentages = conf_percent,
label_set = label_set
))
}
# Define focus groups for KMT2A and MDS
# Full classes that will be shown
kmt2a_groups_full <- c("KMT2A::ELL", "KMT2A::MLLT10", "KMT2A::MLLT4", "KMT2A::SEPT6", "MLLT3::KMT2A")
kmt2a_groups_merged <- c("Other KMT2A rearrangements", "MLLT3::KMT2A")
mds_groups_full <- c("MDS-related, gene mutations", "MDS-related, cytogenetic abnormalities",
"MDS-related, TP53 mutated", "MDS-related")
mds_groups_merged <- c("MDS-related")
# Note: "MDS.r" maps to "MDS-related" so we use "MDS-related" in both
# Combine groups
focus_groups_full <- c(kmt2a_groups_full, mds_groups_full)
focus_groups_merged <- c(kmt2a_groups_merged, mds_groups_merged)
# Get error heatmaps
error_before <- get_error_heatmap(outer_unmerged, "cv", "Full", focus_groups_full)
error_after <- get_error_heatmap(outer_merged, "cv", "Merged", focus_groups_merged)
# Create heatmap function
create_error_heatmap <- function(error_data, title, kmt2a_groups) {
if (is.null(error_data)) {
return(NULL)
}
conf_percent <- error_data$percentages
# Create annotation for groups
# Check which groups are present
present_kmt2a <- intersect(rownames(conf_percent), kmt2a_groups)
group_anno <- ifelse(
rownames(conf_percent) %in% present_kmt2a,
"KMT2A",
"MDS-related"
)
ha <- rowAnnotation(
Group = group_anno,
col = list(Group = c("KMT2A" = "#ff7f0e", "MDS-related" = "#d62728")),
annotation_legend_param = list(title = "Group", title_gp = gpar(fontsize = 9))
)
# Color function for percentages (white to red for errors)
col_fun <- colorRamp2(c(0, 100), c("white", "purple3"))
ht <- Heatmap(
conf_percent,
name = "Error %",
col = col_fun,
cluster_rows = FALSE,
cluster_columns = FALSE,
row_names_side = "left",
column_names_side = "top",
row_names_gp = gpar(fontsize = 9),
column_names_gp = gpar(fontsize = 9),
cell_fun = function(j, i, x, y, width, height, fill) {
val <- conf_percent[i, j]
count <- error_data$counts[i, j]
grid.rect(x, y, width, height, gp = gpar(fill = fill, col = "#d9d9d9", lwd = 0.5))
if (i == j) {
# Diagonal: correct predictions
grid.text(sprintf("%.0f", count), x, y, gp = gpar(fontsize = 8, fontface = "bold"))
} else if (count > 0) {
# Off-diagonal: errors (show all non-zero errors, not just > 5%)
if (val > 1) {
# Show percentage if > 1%
grid.text(sprintf("%.0f\n(%.1f%%)", count, val), x, y, gp = gpar(fontsize = 7))
} else {
# Just show count for very small percentages
grid.text(sprintf("%.0f", count), x, y, gp = gpar(fontsize = 7))
}
}
},
column_title = title,
column_title_gp = gpar(fontsize = 11, fontface = "bold"),
left_annotation = ha,
heatmap_legend_param = list(
title = "Error %",
title_gp = gpar(fontsize = 9),
labels_gp = gpar(fontsize = 8)
)
)
return(ht)
}
# Create heatmaps
ht_before <- create_error_heatmap(error_before, "B. Error Analysis: Full Classes",
kmt2a_groups = kmt2a_groups_full)
ht_after <- create_error_heatmap(error_after, "C. Error Analysis: Merged Classes",
kmt2a_groups = kmt2a_groups_merged)
# Convert heatmaps to ggplot objects
panel_b <- ggplotify::as.ggplot(function() {
draw(ht_before, padding = unit(c(5, 3, 5, 50), "mm"))
})
panel_c <- ggplotify::as.ggplot(function() {
draw(ht_after, padding = unit(c(5, 3, 5, 50), "mm"))
})
# Combine panels
library(cowplot)
three_panel_figure <- plot_grid(
panel_a,
panel_b,
panel_c,
ncol = 3,
align = "h",
rel_widths = c(0.75, 1, 1),
labels = NULL
)
# Save figure
ggsave(
"../writing/figures_new/f1_comparison_error_analysis.png",
three_panel_figure,
width = 600,
height = 200,
units = "mm",
dpi = 300
)
print(three_panel_figure)
library(ggplot2)
library(dplyr)
library(tidyr)
library(ComplexHeatmap)
library(circlize)
library(grid)
library(gridExtra)
# Panel A: F1 Scores Comparison (Full vs Merged)
# Extract F1 scores for full and merged classes
f1_full <- outer_unmerged$per_class_summaries$cv %>%
filter(Model == "OvR_Ensemble") %>%
mutate(Class = gsub("Class: ", "", Class),
Class = fix_names(Class),
Type = "Full",
F1 = Mean_F1) %>%
select(Class, F1, Type)
f1_merged <- outer_merged$per_class_summaries$cv %>%
filter(Model == "OvR_Ensemble") %>%
mutate(Class = gsub("Class: ", "", Class),
Class = fix_names(Class),
Type = "Merged",
F1 = Mean_F1) %>%
select(Class, F1, Type)
# Combine and create comparison data
f1_comparison <- bind_rows(f1_full, f1_merged) %>%
filter(!is.na(F1))
# Define merge mapping for connecting lines
merge_mapping <- list(
"Other KMT2A rearrangements" = c("KMT2A::ELL", "KMT2A::MLLT10", "KMT2A::MLLT4", "KMT2A::SEPT6"),
"MDS-related" = c("MDS-related, gene mutations", "MDS-related, cytogenetic abnormalities", "MDS-related, TP53 mutated", "MDS.r")
)
# Create category groups for coloring
f1_comparison <- f1_comparison %>%
mutate(
Category = case_when(
Class %in% c("PML::RARA", "RUNX1::RUNX1T1", "CBFB::MYH11", "DEK::NUP214", "MECOM rearrangement") ~ "Major rearrangements",
Class %in% c("MLLT3::KMT2A", "Other KMT2A rearrangements", "KMT2A::ELL", "KMT2A::MLLT10", "KMT2A::MLLT4", "KMT2A::SEPT6") ~ "KMT2A rearrangements",
Class %in% c("MDS-related", "MDS-related, gene mutations", "MDS-related, cytogenetic abnormalities", "MDS-related, TP53 mutated", "MDS.r") ~ "MDS-related",
Class %in% c("Mutated NPM1", "CEBPA bZIP in-frame") ~ "Major mutations",
Class %in% c("PRDM16::RPN1", "NPM1::MLF1", "KAT6A::CREBBP", "RBM15::MRTF1", "ETV6::MNX1", "PICALM::MLLT10", "FUS::ERG", "RUNX1::CBFA2T3", "CBFA2T3::GLIS2", "NUP98::NSD1", "NUP98::KDM5A", "NUP98, other partners") ~ "Rare translocations",
TRUE ~ "Other"
)
)
# Order classes consistently
all_classes_ordered <- c(
"PML::RARA", "RUNX1::RUNX1T1", "CBFB::MYH11",
"MLLT3::KMT2A", "Other KMT2A rearrangements", "KMT2A::ELL", "KMT2A::MLLT10", "KMT2A::MLLT4", "KMT2A::SEPT6",
"DEK::NUP214", "MECOM rearrangement", "BCR::ABL1",
"PRDM16::RPN1", "NPM1::MLF1", "KAT6A::CREBBP", "RBM15::MRTF1", "NUP98::KDM5A", "NUP98, other partners",
"ETV6::MNX1", "PICALM::MLLT10", "FUS::ERG", "RUNX1::CBFA2T3", "CBFA2T3::GLIS2",
"NUP98::NSD1", "Mutated NPM1", "CEBPA bZIP in-frame",
"MDS-related", "MDS-related, gene mutations", "MDS-related, cytogenetic abnormalities", "MDS-related, TP53 mutated", "MDS.r"
)
f1_comparison$Class <- factor(f1_comparison$Class, levels = rev(all_classes_ordered))
# Create color palette for categories
category_colors <- c(
"CBF" = "#1f77b4",
"KMT2A" = "#ff7f0e",
"NUP98" = "#2ca02c",
"MDS-related" = "#d62728",
"Rare translocations" = "#9467bd",
"Other" = "#8c564b"
)
# Panel A: F1 Comparison Plot
panel_a <- ggplot(f1_comparison, aes(x = F1, y = Class, color = Category, shape = Type)) +
geom_point(size = 2.5, alpha = 0.8, position = position_dodge(width = 0.5)) +
geom_vline(xintercept = 0.9, linetype = "dashed", color = "gray50", alpha = 0.5) +
scale_color_manual(values = category_colors, name = "Category") +
scale_shape_manual(values = c("Full" = 16, "Merged" = 17), name = "Type") +
labs(
x = "F1 Score",
y = "",
title = "A. F1 Scores: Full vs Merged Classes"
) +
theme_bw() +
theme(
plot.title = element_text(face = "bold", size = 11),
axis.text.y = element_text(size = 8),
axis.text.x = element_text(size = 9),
legend.position = "right",
legend.text = element_text(size = 8),
legend.title = element_text(size = 9)
) +
xlim(0.5, 1.0)
panel_a
library(ggplot2)
library(dplyr)
library(tidyr)
library(ComplexHeatmap)
library(circlize)
library(grid)
library(gridExtra)
# Panel A: F1 Scores Comparison (Full vs Merged)
# Extract F1 scores for full and merged classes
f1_full <- outer_unmerged$per_class_summaries$cv %>%
filter(Model == "OvR_Ensemble") %>%
mutate(Class = gsub("Class: ", "", Class),
Class = fix_names(Class),
Type = "Full",
F1 = Mean_F1) %>%
select(Class, F1, Type)
f1_merged <- outer_merged$per_class_summaries$cv %>%
filter(Model == "OvR_Ensemble") %>%
mutate(Class = gsub("Class: ", "", Class),
Class = fix_names(Class),
Type = "Merged",
F1 = Mean_F1) %>%
select(Class, F1, Type)
# Combine and create comparison data
f1_comparison <- bind_rows(f1_full, f1_merged) %>%
filter(!is.na(F1))
# Define merge mapping for connecting lines
merge_mapping <- list(
"Other KMT2A rearrangements" = c("KMT2A::ELL", "KMT2A::MLLT10", "KMT2A::MLLT4", "KMT2A::SEPT6"),
"MDS-related" = c("MDS-related, gene mutations", "MDS-related, cytogenetic abnormalities", "MDS-related, TP53 mutated", "MDS.r")
)
# Create category groups for coloring
f1_comparison <- f1_comparison %>%
mutate(
Category = case_when(
Class %in% c("PML::RARA", "RUNX1::RUNX1T1", "CBFB::MYH11", "DEK::NUP214", "MECOM rearrangement") ~ "Major rearrangements",
Class %in% c("MLLT3::KMT2A", "Other KMT2A rearrangements", "KMT2A::ELL", "KMT2A::MLLT10", "KMT2A::MLLT4", "KMT2A::SEPT6") ~ "KMT2A rearrangements",
Class %in% c("MDS-related", "MDS-related, gene mutations", "MDS-related, cytogenetic abnormalities", "MDS-related, TP53 mutated", "MDS.r") ~ "MDS-related",
Class %in% c("Mutated NPM1", "CEBPA bZIP in-frame") ~ "Major mutations",
Class %in% c("PRDM16::RPN1", "NPM1::MLF1", "KAT6A::CREBBP", "RBM15::MRTF1", "ETV6::MNX1", "PICALM::MLLT10", "FUS::ERG", "RUNX1::CBFA2T3", "CBFA2T3::GLIS2", "NUP98::NSD1", "NUP98::KDM5A", "NUP98, other partners") ~ "Rare translocations",
TRUE ~ "Other"
)
)
# Order classes consistently
all_classes_ordered <- c(
"PML::RARA", "RUNX1::RUNX1T1", "CBFB::MYH11",
"MLLT3::KMT2A", "Other KMT2A rearrangements", "KMT2A::ELL", "KMT2A::MLLT10", "KMT2A::MLLT4", "KMT2A::SEPT6",
"DEK::NUP214", "MECOM rearrangement", "BCR::ABL1",
"PRDM16::RPN1", "NPM1::MLF1", "KAT6A::CREBBP", "RBM15::MRTF1", "NUP98::KDM5A", "NUP98, other partners",
"ETV6::MNX1", "PICALM::MLLT10", "FUS::ERG", "RUNX1::CBFA2T3", "CBFA2T3::GLIS2",
"NUP98::NSD1", "Mutated NPM1", "CEBPA bZIP in-frame",
"MDS-related", "MDS-related, gene mutations", "MDS-related, cytogenetic abnormalities", "MDS-related, TP53 mutated", "MDS.r"
)
f1_comparison$Class <- factor(f1_comparison$Class, levels = rev(all_classes_ordered))
# Create color palette for categories
category_colors <- c(
"Major rearrangements" = "#1f77b4",
"KMT2A" = "#ff7f0e",
"Major mutations" = "#2ca02c",
"MDS-related" = "#d62728",
"Rare translocations" = "#9467bd"
)
# Panel A: F1 Comparison Plot
panel_a <- ggplot(f1_comparison, aes(x = F1, y = Class, color = Category, shape = Type)) +
geom_point(size = 2.5, alpha = 0.8, position = position_dodge(width = 0.5)) +
geom_vline(xintercept = 0.9, linetype = "dashed", color = "gray50", alpha = 0.5) +
scale_color_manual(values = category_colors, name = "Category") +
scale_shape_manual(values = c("Full" = 16, "Merged" = 17), name = "Type") +
labs(
x = "F1 Score",
y = "",
title = "A. F1 Scores: Full vs Merged Classes"
) +
theme_bw() +
theme(
plot.title = element_text(face = "bold", size = 11),
axis.text.y = element_text(size = 8),
axis.text.x = element_text(size = 9),
legend.position = "right",
legend.text = element_text(size = 8),
legend.title = element_text(size = 9)
) +
xlim(0.5, 1.0)
panel_a
library(ggplot2)
library(dplyr)
library(tidyr)
library(ComplexHeatmap)
library(circlize)
library(grid)
library(gridExtra)
# Panel A: F1 Scores Comparison (Full vs Merged)
# Extract F1 scores for full and merged classes
f1_full <- outer_unmerged$per_class_summaries$cv %>%
filter(Model == "OvR_Ensemble") %>%
mutate(Class = gsub("Class: ", "", Class),
Class = fix_names(Class),
Type = "Full",
F1 = Mean_F1) %>%
select(Class, F1, Type)
f1_merged <- outer_merged$per_class_summaries$cv %>%
filter(Model == "OvR_Ensemble") %>%
mutate(Class = gsub("Class: ", "", Class),
Class = fix_names(Class),
Type = "Merged",
F1 = Mean_F1) %>%
select(Class, F1, Type)
# Combine and create comparison data
f1_comparison <- bind_rows(f1_full, f1_merged) %>%
filter(!is.na(F1))
# Define merge mapping for connecting lines
merge_mapping <- list(
"Other KMT2A rearrangements" = c("KMT2A::ELL", "KMT2A::MLLT10", "KMT2A::MLLT4", "KMT2A::SEPT6"),
"MDS-related" = c("MDS-related, gene mutations", "MDS-related, cytogenetic abnormalities", "MDS-related, TP53 mutated", "MDS.r")
)
# Create category groups for coloring
f1_comparison <- f1_comparison %>%
mutate(
Category = case_when(
Class %in% c("PML::RARA", "RUNX1::RUNX1T1", "CBFB::MYH11", "DEK::NUP214", "MECOM rearrangement") ~ "Major rearrangements",
Class %in% c("MLLT3::KMT2A", "Other KMT2A rearrangements", "KMT2A::ELL", "KMT2A::MLLT10", "KMT2A::MLLT4", "KMT2A::SEPT6") ~ "KMT2A rearrangements",
Class %in% c("MDS-related", "MDS-related, gene mutations", "MDS-related, cytogenetic abnormalities", "MDS-related, TP53 mutated", "MDS.r") ~ "MDS-related",
Class %in% c("Mutated NPM1", "CEBPA bZIP in-frame") ~ "Major mutations",
Class %in% c("PRDM16::RPN1", "NPM1::MLF1", "KAT6A::CREBBP", "RBM15::MRTF1", "ETV6::MNX1", "PICALM::MLLT10", "FUS::ERG", "RUNX1::CBFA2T3", "CBFA2T3::GLIS2", "NUP98::NSD1", "NUP98::KDM5A", "NUP98, other partners") ~ "Rare translocations",
TRUE ~ "Other"
)
)
# Order classes consistently
all_classes_ordered <- c(
"PML::RARA", "RUNX1::RUNX1T1", "CBFB::MYH11",
"MLLT3::KMT2A", "Other KMT2A rearrangements", "KMT2A::ELL", "KMT2A::MLLT10", "KMT2A::MLLT4", "KMT2A::SEPT6",
"DEK::NUP214", "MECOM rearrangement", "BCR::ABL1",
"PRDM16::RPN1", "NPM1::MLF1", "KAT6A::CREBBP", "RBM15::MRTF1", "NUP98::KDM5A", "NUP98, other partners",
"ETV6::MNX1", "PICALM::MLLT10", "FUS::ERG", "RUNX1::CBFA2T3", "CBFA2T3::GLIS2",
"NUP98::NSD1", "Mutated NPM1", "CEBPA bZIP in-frame",
"MDS-related", "MDS-related, gene mutations", "MDS-related, cytogenetic abnormalities", "MDS-related, TP53 mutated", "MDS.r"
)
f1_comparison$Class <- factor(f1_comparison$Class, levels = rev(all_classes_ordered))
# Create color palette for categories
category_colors <- c(
"Major rearrangements" = "#1f77b4",
"KMT2A" = "#ff7f0e",
"Major mutations" = "#2ca02c",
"MDS-related" = "#d62728",
"Rare translocations" = "#9467bd"
)
# Panel A: F1 Comparison Plot
panel_a <- ggplot(f1_comparison, aes(x = F1, y = Class, color = Category, shape = Type)) +
geom_point(size = 2.5, alpha = 0.8, position = position_dodge(width = 0.5)) +
geom_vline(xintercept = 0.9, linetype = "dashed", color = "gray50", alpha = 0.5) +
scale_color_manual(values = category_colors, name = "Category") +
scale_shape_manual(values = c("Full" = 16, "Merged" = 17), name = "Type") +
labs(
x = "F1 Score",
y = "",
title = "A. F1 Scores: Full vs Merged Classes"
) +
theme_bw() +
theme(
plot.title = element_text(face = "bold", size = 11),
axis.text.y = element_text(size = 8),
axis.text.x = element_text(size = 9),
legend.position = "right",
legend.text = element_text(size = 8),
legend.title = element_text(size = 9)
) +
xlim(0.65, 1.0)
panel_a
setwd("~/leukem_ai/R")
source("inner_cv_analysis.R")
source("outer_cv_analysis.R")
#outer_merged <- readRDS("../data/out/outer_cv/outer_cv_results_5jan2025_merged.rds")
#outer_merged[["performance_summaries"]]
library(dplyr)
#outer_merged[["per_class_summaries"]][["cv"]] %>% filter(grepl("OvR", Model)) %>% select(Class, Mean_F1)
#outer_unmerged <- readRDS("../data/out/outer_cv/outer_cv_results_5jan2025_unmerged.rds")
#outer_unmerged[["performance_summaries"]]
#outer_unmerged[["per_class_summaries"]][["cv"]] %>% filter(grepl("OvR", Model)) %>% select(Class, Mean_F1)
source("train_test_analysis.R")
